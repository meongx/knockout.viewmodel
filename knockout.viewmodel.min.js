-//v2.0.3 - C 2013, Dave Herren, License: MIT 
(function(h,p){"function"===typeof define&&define.amd?define(["knockout"],function(n){n=p(n);return h.ko?h.ko.viewmodel=n:n}):h.ko.viewmodel=p(h.ko)})(this,function(h){function p(a,g){var f=a?a[g.full]||a[g.parent]||a[g.name]||{}:{};l&&l(g,f,a);return f}function n(a){return null===a||void 0===a}function s(a){return null===a||void 0===a||a.constructor===String||a.constructor===Number||a.constructor===Boolean||a instanceof Date}function q(a,g,f,d){var b,c,e,m,k,h;d=d||p(g,f);var l;if(b=d.custom)h=!0,
"function"===typeof b?c=b(a):(c=b.map(a),n(c)||(c.___$mapCustom=b.map,b.unmap&&(c.___$unmapCustom=b.unmap)));else if(d.append)h=!0,c=a;else{if(d.exclude)return h=!0,t;if(s(a))c=f.parentIsArray?a:z(a);else if(a instanceof Array){c=[];e=0;for(b=a.length;e<b;e++)c[e]=q(a[e],g,{name:"[i]",parent:f.name+"[i]",full:f.full+"[i]",parentIsArray:!0});if(!f.parentIsArray||y){m={name:"[i]",parent:f.name+"[i]",full:f.full+"[i]",parentIsArray:!0};c=A(c);if(a=d.arrayChildId)c.___$childIdName=a;c.pushFromModel=function(a){a=
q(a,g,m);c.push(a)};c.unshiftFromModel=function(a){a=q(a,g,m);c.unshift(a)};c.popToModel=function(a){a=c.pop();return r(a,m)};c.shiftToModel=function(a){a=c.shift();return r(a,m)}}}else if(a.constructor===Object)for(e in c={},a)m={name:e,parent:("[i]"===f.name?f.parent:f.name)+"."+e,full:f.full+"."+e},l=a[e],(b=s(l)?p(g,m):void 0)&&b.custom?(c.___$customChildren=c.___$customChildren||{},c.___$customChildren[e]=b.custom,c[e]="function"===typeof b.custom?b.custom(a[e]):b.custom.map(a[e])):(b=q(l,g,
m,b),b!==t&&(c[e]=b))}!h&&(k=d.extend)&&("function"===typeof k?c=k(c)||c:k.constructor===Object&&("function"===typeof k.map&&(c=k.map(c)||c),"function"===typeof k.unmap&&(c.___$unmapExtend=k.unmap)));return c}function r(a,g){var f,d,b,c=u(a),e;e=a!==c;l&&l(g);if(!e&&a&&a.constructor===Function)return t;if(a&&a.___$unmapCustom)f=a.___$unmapCustom(a);else if(e&&s(c)||n(c))f=c;else if(c instanceof Array)for(f=[],d=0,b=c.length;d<b;d++)f[d]=r(c[d],{name:"[i]",parent:g.name+"[i]",full:g.full+"[i]"});else if(c.constructor===
Object)for(d in f={},c)"___$"!==d.substr(0,4)&&(a.___$customChildren&&a.___$customChildren[d]&&a.___$customChildren[d].unmap?f[d]=a.___$customChildren[d].unmap(c[d]):(e=c[d],h.isComputed(e)||(b=u(e))&&b.constructor===Function||(e=r(e,{name:d,parent:("[i]"===g.name?g.parent:g.name)+"."+d,full:g.full+"."+d}),e!==t&&(f[d]=e))));else e||"function"===typeof c||(f=c);a&&a.___$unmapExtend&&(f=a.___$unmapExtend(f,a));return f}function v(a,g,f,d){var b,c,e,m,k,h;d=u(g);c=g!==d;l&&l(f);if(c&&n(d)^n(a))g(a);
else if(a&&d&&d.constructor==Object&&a.constructor===Object)for(b in a)g.___$customChildren&&g.___$customChildren[b]?(e=g.___$customChildren[b].map||g.___$customChildren[b],d[b]=e(a[b])):(e=d[b],!c&&d.hasOwnProperty(b)&&(s(e)||e&&e.constructor===Array)?d[b]=a[b]:e&&"function"===typeof e.___$mapCustom?B(e)?(m=e.___$mapCustom(a[b]),m=u(m),e(m)):d[b]=d[b].___$mapCustom(a[b]):n(a[b])&&d[b]&&d[b].constructor===Object?d[b]=a[b]:v(a[b],d[b],{name:b,parent:("[i]"===f.name?f.parent:f.name)+"."+b,full:f.full+
"."+b},d));else if(d&&d instanceof Array)if(h=g.___$childIdName){m=[];for(b=a.length-1;0<=b;b--){e=!1;k=a[b][h];for(c=d.length-1;0<=c;c--)if(k===d[c][h]()){v(a[b],d[c],{name:"[i]",parent:f.name+"[i]",full:f.full+"[i]"});e=!0;m[c]=!0;break}e||g.splice(b,1)}for(b=a.length-1;0<=b;b--)m[b]||g.pushFromModel(a[b])}else if(c=[],d=g.___$mapCustom,"function"===typeof d){b=0;for(f=a.length;b<f;b++)c[b]=a[b];g(d(c))}else for(g(c),b=0,f=a?a.length:0;b<f;b++)g.pushFromModel(a[b]);else c&&g(a)}function w(a,g){y=
a.makeChildArraysObservable;window.console&&a.logging?(console.log(g),l=function(a,d,b){console.log("- "+(d&&d.settingType?d.settingType+" "+a.full+" (matched: '"+((b[a.full]?a.full:"")||(b[a.parent]?a.parent:"")||a.name)+"')":"default "+a.full))}):l=void 0}var u=h.utils.unwrapObservable,B=h.isObservable,z=h.observable,A=h.observableArray,x={name:"{root}",parent:"{root}",full:"{root}"},l,y,t=function(){};h.viewmodel={options:{makeChildArraysObservable:!0,logging:!1},fromModel:function(a,g){var f=
{},d=g?g.shared||{}:{},b,c,e,h,k,l,n;for(k in g)if(b=g[k]||{},"shared"!==k)if(b instanceof Array)for(c=0,h=b.length;c<h;c++)e=b[c],f[e]=f[e]||{},f[e][k]=!0,f[e].settingType=f[e].settingType?"multiple":k;else if(b.constructor===Object)for(e in b){f[e]=f[e]||{};c=b[e];if((c="arrayChildId"!==k&&c&&c.constructor===String&&d[c]?d[c]:c)&&c.constructor===Object)for(l in c)(n=c[l])&&n.constructor==String&&d[n]&&(c[l]=d[n]);f[e][k]=c;f[e].settingType=f[e].settingType?"multiple":k}w(this.options,"Mapping From Model");
return q(a,f,x)},toModel:function(a){w(this.options,"Mapping To Model");return r(a,x)},updateFromModel:function(a,g){w(this.options,"Update From Model");return v(g,a,x)}};return h.viewmodel});